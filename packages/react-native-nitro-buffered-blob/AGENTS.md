<!-- Parent: ../../AGENTS.md -->
<!-- Generated: 2026-02-15 | Updated: 2026-02-16 -->

# react-native-nitro-buffered-blob

## Purpose
A React Native native module providing zero-copy buffered blob (file) I/O using Margelo's Nitro framework. Implements streaming file read/write, file system operations (exists, stat, unlink, mkdir, ls, cp, mv), file hashing (SHA256, MD5), and downloads with progress callbacks. Uses Nitrogen codegen to generate C++/Swift/Kotlin bridges from TypeScript specs.

## Architecture
- **HybridObjects**: Each capability (reader, writer, downloader) is a separate HybridObject with its own lifecycle
- **Stream factories**: `BufferedBlobModule.openRead/openWrite/createDownload` return HybridObject instances synchronously; I/O methods are async
- **Zero-copy**: ArrayBuffer is transferred between JS and native without serialization via Nitro's native bridges
- **Platform implementations**: Swift on iOS, Kotlin on Android; no shared C++ layer (unlike the Turbo Module sibling)

## Key Files

| File | Description |
|------|-------------|
| `package.json` | Package config with nitro-modules peer dep, nitrogen codegen script |
| `nitro.json` | Nitrogen codegen config: C++ namespace, iOS/Android module names, autolinking |
| `tsconfig.json` / `tsconfig.build.json` | Strict TypeScript config |
| `NitroBufferedBlob.podspec` | CocoaPods spec for iOS; loads Nitrogen autolinking files |
| `react-native.config.js` | React Native CLI autolinking configuration |

## Subdirectories

| Directory | Purpose |
|-----------|---------|
| `src/` | TypeScript barrel exports (see `src/AGENTS.md`) |
| `src/specs/` | Nitro HybridObject interface specs — `.nitro.ts` files (see `src/specs/AGENTS.md`) |
| `ios/` | Swift HybridObject implementations (see `ios/AGENTS.md`) |
| `android/` | Kotlin HybridObject implementations + Gradle/CMake config (see `android/AGENTS.md`) |
| `nitrogen/` | Nitrogen codegen output — auto-generated, do NOT edit (see `nitrogen/AGENTS.md`) |
| `lib/` | Compiled TypeScript output (generated by builder-bob, do not edit) |

## For AI Agents

### Working In This Directory
1. **Edit specs** in `src/specs/*.nitro.ts` to define HybridObject interfaces
2. **Run `yarn nitrogen`** to generate C++/Swift/Kotlin specs into `nitrogen/generated/`
3. **Implement native code** in `ios/*.swift` and `android/src/main/java/.../Hybrid*.kt`
4. **Never edit** files in `nitrogen/generated/` — they are overwritten on codegen
5. **Build**: `yarn native prepare` runs nitrogen + bob build

### Adding a New HybridObject
1. Create `src/specs/MyObject.nitro.ts` with interface extending `HybridObject<{ ios: 'swift'; android: 'kotlin' }>`
2. Run `yarn nitrogen`
3. Implement `ios/HybridMyObject.swift` and `android/.../HybridMyObject.kt`
4. Export type from `src/index.ts`

### Testing Requirements
- **Type checking**: `yarn native typecheck` (runs `tsc --noEmit`)
- **No unit tests** at this layer; integration testing via `examples/nitro-buffered-blob-example`
- Verify generated code compiles after `yarn nitrogen`

### Common Patterns
- `NativeFileReader.readNextChunk()` returns `Promise<ArrayBuffer | undefined>` — `undefined` means EOF
- `NativeFileWriter.write(data)` returns `Promise<Int64>` — bytes written
- `NativeDownloader.start(onProgress)` takes a callback receiving `DownloadProgress` struct
- Thread safety: each reader/writer/downloader is single-threaded; create separate instances for concurrent I/O

## Dependencies

### Internal
- `react-native-nitro-modules` (peer) — Runtime HybridObject bridge
- `nitrogen` (dev) — Codegen tool

### External
- **iOS**: Foundation (FileManager, InputStream/OutputStream), URLSession (downloads)
- **Android**: java.io (FileInputStream/FileOutputStream), OkHttp 3 (downloads), Kotlin Coroutines
- **Build**: react-native-builder-bob, Gradle 8.x, Xcode 16+, TypeScript 5.9.2

<!-- MANUAL: -->
